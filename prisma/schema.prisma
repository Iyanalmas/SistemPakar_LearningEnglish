generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Question {
  id            Int       @id @default(autoincrement())
  question_code String    @unique
  question      String
  answers       Answer[]  @relation("QuestionAnswers")
  orderNumber   Int?      // Urutan pertanyaan
  isActive      Boolean   @default(true) // Untuk menonaktifkan pertanyaan
}
model Answer {
  id         Int      @id @default(autoincrement())
  isYes      Boolean  // Jawaban Ya (true) atau Tidak (false)
  questionId Int
  sessionId  Int
  
  question   Question @relation("QuestionAnswers", fields: [questionId], references: [id])
  session    Session  @relation("SessionAnswers", fields: [sessionId], references: [id])

  @@index([questionId, sessionId])
}

model Users {
  id       Int       @id @default(autoincrement())
  nama     String
  umur     String
  kelas    String
  sessions Session[] @relation("UserSession")
}

model Session {
  id          Int      @id @default(autoincrement())
  userId      Int
  completed   Boolean  @default(false)
  result      LearningPath? @relation("SessionResult", fields: [resultId], references: [id])
  resultId    Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user        Users    @relation("UserSession", fields: [userId], references: [id])
  answers     Answer[] @relation("SessionAnswers")
}

model LearningPath {
  id          Int       @id @default(autoincrement())
  code        String    @unique
  name        String    // Nama jalur pembelajaran
  description String    // Deskripsi detail
  level       String    // Tingkat kesulitan
  sessions    Session[] @relation("SessionResult")
  rules       Rule[]    @relation("PathRules")
}

model Rule {
  id             Int         @id @default(autoincrement())
  learningPathId Int
  conditions     Json        // Array of conditions (question_code dan expected answer)
  priority       Int         @default(0)
  
  learningPath   LearningPath @relation("PathRules", fields: [learningPathId], references: [id])

  @@index([learningPathId])
}